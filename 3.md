# SendMessage
## 説明
> このインターフェイスは、指定されたメッセージキューにメッセージを送信するために使用します。デフォルトでは、送信されたメッセージは直ちにコンシューマーが取得できます。スケジュール済みタスクなど、メッセージが直ちに取得されないことが予想される場合、メッセージの送信時に DelaySeconds パラメーターがプロデューサーによって追加されることが考えられます。DelaySeconds 値が正の値であるメッセージのステータスは、[Delayed] になります。このようなメッセージは、DelaySeconds が経過して [Active] ステータスになるまで、どのコンシューマーも取得できません。

**ヒント:**

メッセージの送信時に指定された DelaySeconds は、メッセージの DelaySeconds 属性よりも優先されます。つまり、この 2 つの DelaySeconds 値が異なる場合は、メッセージで指定された DelaySeconds が優先されます。

##リクエスト
リクエストには、主に次の項目があります。

- リクエスト行
> `POST /$queueName/messages HTTP/1.1`

- 特別なリクエストヘッダー
> なし。「パブリックリクエストヘッダー」を参照してください。

- リクエスト本文
> リクエスト本文は、XML 形式です。XML には、作成されるメッセージの属性が含まれています。


|パラメーター名|説明|パラメーター値|
|---|---|---|
|MessageBody|必須。メッセージ本文。	|UTF-8 文字セット。|
|DelaySeconds|任意。メッセージを取得できるようになるまでの遅延時間 (秒)。|	0 から 604800 秒 (7 日間) までの整数。デフォルト値は 0。|
|Priority|任意。指定されたメッセージの優先順位。優先順位の高いメッセージほど、先に取得される確率が高まります。|	値の範囲は 1 から 16 (値 1 が最も高い優先順位)。デフォルト値は 8。|

##	応答
返されるメッセージには、戻りステータス行、HTTP ヘッダー、メッセージ本文の 3 つがあります。

- HTTP ステータスコード
> HTTP/1.1 201 Created

- 特別な応答ヘッダー
> なし。「パブリックリターンヘッダー」を参照してください。

- 応答本文
> 結果は XML 形式で返されます。メッセージの下位要素である MessageId と MessageBodyMD5 が返されます。

|パラメーター名|	説明|
|---|---|
|MessageId|	メッセージ ID、各キューの中で一意。
|MessageBodyMD5|	メッセージ本文の MD5 値。|

## 特殊なエラー
|エラーコード|	エラーメッセージ|	ステータスコード|
|---|---|---|
|QueueNotExist|	指定された名前のキューは存在しません。|	404|
|MalformedXML|	指定された XML の形式が誤っています。|	400|
|InvalidArgument|	Element の値は、MIN と MAX の間の秒数またはバイト数にする必要があります。|	400|

**リクエストの例:**

```xml
    POST /queues/$queueName/messages HTTP/1.1
    Host: $AccountId.mns.cn-hangzhou.aliyuncs.com
    Date: Wed, 18 Mar 2012 12:00:00 GMT
    Content-Length:500
    Content-Type:text/xml;charset=utf-8
    x-mns-version: 2015-06-06
    Authorization: MNS 15B4D3461F177624206A:xQE0diMbLRepdf3YB+FIEXAMPLE
    
    <?xml version="1.0” encoding=”UTF-8” ?>
    <Message xmlns=”http://mns.aliyuncs.com/doc/v1/”>
    <MessageBody>Base64 Encoded Result</MessageBody>
    <DelaySeconds>60</DelaySeconds>
    <Priority>1</Priority>
    </Message>
```

**戻り値ヘッダーの例:**

```xml
    HTTP/1.1 201Created
    Connnection:close
    Content-Length:120
    Content-Type:text/xml;charset=utf-8
    x-mqs-request-id:512B2A634403E52B1956133E
    x-mqs-version:2015-06-06

    <?xml version="1.0" encoding="UTF-8" ?>
    <Message xmlns="http://mqs.aliyuncs.com/doc/v1/">
    	<MessageId>5F290C926D472878-2-14D9529A8FA-200000001</MessageId>
    	<MessageBodyMD5>C5DD56A39F5F7BB8B3337C6D11B6D8C7</MessageBodyMD5>
    </Message>
```
# BatchSendMessage
##	説明
This interface is used to send messages to the specified message queue in batches. A maximum of 16 messages can be sent in one BatchSendMessage operation.

A common message can be consumed by the consumer immediately after being sent to a message queue. The producer can set the DelaySeconds parameter when sending the message to consume later(the typical scenario is a scheduled task). The initial status of a message with the DelaySeconds value(>0) is Delayed. The message can not be consumed till its status turns to Active after its DelaySeconds time expires In this status.

Tip:

The priority of the DelaySeconds parameter specified upon message sending is higher than the DelaySeconds attribute of the delayed message queue. That means, when the values of the two DelaySeconds attributes are different, the value of the DelaySeconds parameter specified upon message sending takes precedence.

##Request A request mainly includes the following parts:

Request line

POST /queues/$queueName/messages HTTP/1.1

Special Request Header

None. See "Public Request Headers".

Request Body

Request Body is in XML format. XML contains the attributes for creating messages.

|Parameter Name|Description|Parameter Value|
| --- | --- | --- |
|MessageBody|Required. Message body|UTF-8 character set|
|DelaySeconds|Optional. A delay time after which a message can be consumed, measured in seconds|An integer between 0 and 604800 (7 days). The default value is 0|
|Priority|Optional. Priority of a specified message.A message with a higher priority is more likely to be consumed earlier|The value ranges from 1 to 16 (the value 1 indicates the highest priority). The default value is 8|

# Response
The returned message includes 3 parts: returned status line, HTTP header and message body.

- HTTP Status Code
   - HTTP/1.1 201 Created

- Special Response Header
   - None. See "Public Returned Headers"n

- Response Body

  The return result is in XML format. The MessageId and MessageBodyMD5 sub-elements of multiple messages are returned.

|Parameter Name|Description|
|  ---  | --- |
|MessageId|Message ID, which is unique in one queue.|
|MessageBodyMD5|MD5 value of the message body|

## Special Error:

|Error Code|Error Message|Status Code|
| --- | --- | --- |
|QueueNotExist|The queue name you provided is not exist.|404|
|MalformedXML|The XML you provided was not well-formed.|400|
|InvalidArgument|The value of Element should between Low and High seconds/bytes.|400|

## Request example:

```
   POST /queues/$queueName/messages HTTP/1.1
    Host: $AccountId.mns.cn-hangzhou.aliyuncs.com
    Date: Wed, 18 Mar 2012 12:00:00 GMT
    Content-Length:500
    Content-Type:text/xml;charset=utf-8
    x-mns-version: 2015-06-06
    Authorization: MNS 15B4D3461F177624206A:xQE0diMbLRepdf3YB+FIEXAMPLE

    <?xml version="1.0” encoding=”UTF-8” ?>
    <Messages xmlns=”http://mns.aliyuncs.com/doc/v1/”>
	<Message>
		<MessageBody>Message1 Base64 Encoded Result</MessageBody>
		<DelaySeconds>60</DelaySeconds>
		<Priority>1</Priority>
	</Message>
	<Message>
		<MessageBody>Message2 Base64 Encoded Result</MessageBody>
		<DelaySeconds>60</DelaySeconds>
		<Priority>1</Priority>
	</Message>
    </Messages>
```

## Response example:

```
HTTP/1.1 201Created
    Connnection:close
    Content-Length:120
    Content-Type:text/xml;charset=utf-8
    x-mns-request-id:512B2A634403E52B1956133E
    x-mns-version: 2015-06-06

    <?xml version="1.0” encoding=”UTF-8” ?>
    <Messages xmlns=”http://mns.aliyuncs.com/doc/v1/”>
	<Message>
		<MessageId>5F290C926D472878-2-14D9529A8FA-200000001</MessageId>
		<MessageBodyMD5>C5DD56A39F5F7BB8B3337C6D11B6D8C7</MessageBodyMD5>
	</Message>
	<Message>
		<MessageId>5F290C926D472878-2-14D9529A8FA-200000002</MessageId>
		<MessageBodyMD5>377AC5283D8765C9CEE4E0EA353DFC17</MessageBodyMD5>
	</Message>
    </Messages>
```

# ReceiveMessage
##	説明
> このインターフェイスは、コンシューマーがメッセージキュー内のメッセージを取得するために使用するものです。この ReceiveMessage 操作により、取得されたメッセージは [Inactive] ステータスに変わります。Inactive 期間は、キューの VisibilityTimeout 属性によって決まります (詳細については、「CreateQueue インターフェイス」を参照してください)。

> メッセージが正常にコンシューマーによって取得されたら、VisibilityTimeout の間に DeleteMessage インターフェイスを呼び出してメッセージを削除する必要があります。削除しない場合、メッセージは [Active] ステータスに戻り、再びコンシューマーによって取得されます。

## リクエスト
リクエストには、主に次の項目があります。

- リクエスト行
> `GET /$queueName/messages?waitseconds=10 HTTP/1.1`

- 特別な URI パラメーター

|パラメーター名	|説明|	必須かどうか|
|---|---|---|
|waitseconds|ReceiveMessage リクエストのポーリング最大待ち時間①(秒)|任意|

**注意:**
> ①	ReceiveMessage リクエストで waitseconds パラメーターが指定されている場合、その ReceiveMessage リクエストのポーリング待ち時間は waitseconds によって指定されます。waitseconds パラメーターが指定されていない場合、ポーリング待ち時間はキューの PollingWaitSeconds 属性によって指定されます (「CreateQueue インターフェイス」を参照してください)。

- 特別なリクエストヘッダー
> なし。「パブリックリクエストヘッダー」を参照してください。

- リクエスト本文
> なし。

## 応答
返されるメッセージには、戻りステータス行、HTTP ヘッダー、メッセージ本文の 3 つがあります。

- HTTP ステータスコード
> HTTP/1.1 200 OK

- 特別な応答ヘッダー
> なし。「パブリックリターンヘッダー」を参照してください。

- 応答本文
> 結果は XML 形式で返されます。メッセージのメッセージ本文と属性が返されます。

|パラメーター名|	説明|
|---|---|
|MessageId|メッセージ ID、各キューの中で一意|
|ReceiptHandle|取得したメッセージのために生成された一時的なハンドル。[Inactive] ステータスで、NextVisibleTime になる前の有効なメッセージを削除または変更するために使用します。|
|MessageBody|メッセージ本文|
|MessageBodyMD5|メッセージ本文の MD5 値|
|EnqueueTime|メッセージがキューに送信された日時を 1970 年 1 月 1 日 0:00 からのミリ秒単位の経過時間で表した値|
|NextVisibleTime|メッセージを再度取得できる日時を 1970 年 1 月 1 日 0:00 からのミリ秒単位の経過時間で表した値|
|FirstDequeueTime|メッセージが最初に取得された日時を 1970 年 1 月 1 日 0:00 からのミリ秒単位の経過時間で表した値|
|DequeueCount|メッセージが取得された合計回数|
|Priority|メッセージの優先順位|

## 特殊なエラー
|エラーコード|	エラーメッセージ|	ステータスコード|
|---|---|---|
|QueueNotExist|	指定された名前のキューは存在しません。	|404|
|MessageNotExist|	メッセージが存在しません。|	404|

**リクエストの例:**

```
    GET  /$queueName/messages HTTP/1.1
    Host: $AccountId.mqs-cn-hangzhou.aliyuncs.com
    Date: Wed, 28 May 2012 22:32:00 GMT
    x-mqs-version: 2014-07-08
    Authorization: MQS 15B4D3461F177624206A:xQE0diMbLRepdf3YB+FIEXAMPLE
 ```

** 戻り値の例: **

```
    HTTP/1.1 200 OK
    Connection:close
    Content-Type=text/xml;charset=utf-8
    Content-Length:500
    x-mqs-request-id:512B2A634403E52B1956133E
    x-mqs-version:2015-06-06

    <?xml version="1.0" encoding="UTF-8" ?>
    <Message xmlns="http://mqs.aliyuncs.com/doc/v1/">
    	<MessageId>5F290C926D472878-2-14D9529A8FA-200000001</MessageId>
    	<ReceiptHandle>1-ODU4OTkzNDU5My0xNDMyNzI3ODI3LTItOA==</ReceiptHandle>
    	<MessageBodyMD5>C5DD56A39F5F7BB8B3337C6D11B6D8C7</MessageBodyMD5>
    	<MessageBody>This is a test message</MessageBody>
    	<EnqueueTime>1250700979248</EnqueueTime>
    	<NextVisibleTime>1250700799348</NextVisibleTime>
    	<FirstDequeueTime>1250700779318</FirstDequeueTime >
    	<DequeueCount>1</DequeueCount >
    	<Priority>8</Priority>
    </Message>

 ```

# BatchReceiveMessage
## Description
This interface is used by the consumer to consume messages in a queue in batches. A maximum of 16 messages can be acquired in one BatchReceiveMessage operation.This operation will change the acquired messages to Inactive status. The Inactive duration is determined by the VisibilityTimeout attribute of the queue (for details, see "CreateQueue Interface").

After the messages are successfully consumed, the DeleteMessage interface should be called to delete the acquired messages in the VisibilityTimeout period. Otherwise, the acquired messages will be reset to Active status and consumable again.

## Request

A request mainly includes the following parts:

- Request line

   GET /queues/$queueName/messages?numOfMessages=16&waitseconds=10 HTTP/1.1

- Special URI Parameter

|Parameter Name|Description|Required?|
| --- | --- | --- |
|numOfMessages|Maximum number of messages that can be acquired for the current BatchReceiveMessage operation.|Required|
|waitseconds|Maximum polling waiting time① of the ReceiveMessage request, measured in seconds.|Optional|

**Note:**

The polling waiting time of the BatchReceiveMessage request is specified by its preset waitseconds, or the PollingWaitSeconds attribute of the queue without presetting waitseconds (refer to "CreateQueue Interface").

- Special Request Header

   None. See "Public Request Headers".

- Request Body

   None.

## Response

The returned message includes 3 parts: returned status line, HTTP header and message body.

- HTTP Status Code

  HTTP/1.1 200 OK

- Special Response Header

   None. See "Public Returned Headers".

- Response Body

   The return result is in XML format. The message bodies and attributes of multiple messages are returned.

|Parameter Name|Description|
| --- | --- |
|MessageId|Message ID, which is unique in one queue|
|ReceiptHandle|Temporary handle generated for the acquired message, which is used to delete or modify the message in Inactive status and is valid before NextVisibleTime.|
|MessageBody|Message body|
|MessageBodyMD5|MD5 value of the message body|
|EnqueueTime|Time when a message is sent to the queue, represented in milliseconds that have elapsed since 1970-1-1 0:00|
|NextVisibleTime|Time when a message can be consumed again, represented in milliseconds that have elapsed since 1970-1-1 0:00|
|FirstDequeueTime|Time when a message is consumed for the first time, represented in milliseconds that have elapsed since 1970-1-1 0:00|
|DequeueCount|Total consumption times of a message
|Priority|Priority of a message|

## Special Error

|Error Code|Error Message|Status Code|
|---|---|---|
|QueueNotExist|The queue name you provided is not exist.|404|
|MessageNotExist|Message not exist.|404|

**Request example:**
```
	GET  /queues/$queueName/messages?numOfMessages=16 HTTP/1.1
    Host: $AccountId.mns.cn-hangzhou.aliyuncs.com
    Date: Wed, 28 May 2012 22:32:00 GMT
    x-mns-version: 2015-06-06
    Authorization: MNS 15B4D3461F177624206A:xQE0diMbLRepdf3YB+FIEXAMPLE
```
**Response example:**
```
    HTTP/1.1 200 OK
    Connection:close
    Content-Type=text/xml;charset=utf-8
    Content-Length:500
    x-mns-request-id:512B2A634403E52B1956133E
    x-mns-version: 2015-06-06

    <?xml version="1.0” encoding=”UTF-8” ?>
    <Messages xmlns=”http://mns.aliyuncs.com/doc/v1/”>
	<Message>
		<MessageId>5F290C926D472878-2-14D9529A8FA-200000001</MessageId>
		<ReceiptHandle>1-ODU4OTkzNDU5My0xNDMyNzI3ODI3LTItOA==</ReceiptHandle>
		<MessageBodyMD5>C5DD56A39F5F7BB8B3337C6D11B6D8C7</MessageBodyMD5>
		<MessageBody>This is a test message</MessageBody>
		<EnqueueTime>1250700979248</EnqueueTime>
		<NextVisibleTime>1250700799348</NextVisibleTime>
		<FirstDequeueTime>1250700779318</FirstDequeueTime >
		<DequeueCount>1</DequeueCount>
		<Priority>8</Priority>
	</Message>
	<Message>
		<ReceiptHandle>1-ODU4OTkzNDU5My0xNDMyNzI3MjQwLTEtOA==</ReceiptHandle>
		<MessageBodyMD5>C5DD56A39F5F7BB8B3337C6D11B6D8C7</MessageBodyMD5>
		<MessageBody>This is a test message</MessageBody>
		<EnqueueTime>1250700979252</EnqueueTime>
		<NextVisibleTime>1250700799350</NextVisibleTime>
		<FirstDequeueTime>1250700779330</FirstDequeueTime >
		<DequeueCount>1</DequeueCount>
		<Priority>8</Priority>
	</Message>
    </Messages>
```

#	DeleteMessage
##	説明
このインターフェイスは、取得済みのメッセージを削除するために使用します。削除するメッセージを特定するために、前回の取得で入手した有効な ReceiptHandle が必要です。この削除操作を成功するためには、NextVisibleTime の前に実行する必要があります。NextVisibleTime が過ぎるとメッセージは再び Active になり、ReceiptHandle は無効になって、削除は失敗します。

##	リクエスト
リクエストには、主に次の項目があります。

- リクエスト行
> `DELETE/$queueName/messages?receiptHandle=<receiptHandle> HTTP/1.1`

- 特別な URI パラメーター

|パラメーター名|	説明|	必須かどうか|
|---|---|---|
|ReceiptHandle|	前回の取得で返された ReceiptHandle。詳細については、「ReceiveMessage インターフェイス」を参照してください。|必須|

- 特別なリクエストヘッダー
	なし。「パブリックリクエストヘッダー」を参照してください。
- リクエスト本文
	なし。

## 応答
返されるメッセージには、戻りステータス行、HTTP ヘッダー、メッセージ本文の 3 つがあります。

- HTTP ステータスコード
> HTTP/1.1 204 NoContent

- 特別な応答ヘッダー
> なし。「パブリックリターンヘッダー」を参照してください。

- 応答本文
> なし。

##	特殊なエラー

|エラーコード|エラーメッセージ|ステータスコード|
|---|---|---|
|QueueNotExist|指定された名前のキューは存在しません。	|404|
|InvalidArgument|Element の値は、Low と High の間の秒数またはバイト数にする必要があります。	|400|
|ReceiptHandleError	|指定された受信ハンドルが無効です。|	400|

**リクエストの例:**

```
    DELETE  /queues/$queueName/messages?ReceiptHandle=MbZj6wDWli+QEauMZc8ZRv37sIW2iJKq3M9Mx/KSbkJ0 HTTP/1.1
    Host: $AccountId.mns.cn-hangzhou.aliyuncs.com
    Date: Wed, 28 May 2012 22:32:00 GMT
    x-mns-version: 2015-06-06
    Authorization: MNS 15B4D3461F177624206A:xQE0diMbLRepdf3YB+FIEXAMPLE
 ```

**戻り値の例:**

```
    HTTP/1.1 204 NoContent
    x-mqs-request-id:512B2A634403E52B1956133E
    x-mqs-version: 2015-06-06
```

# BatchDeleteMessage
##Description
This interface is used to delete multiple messages at a maximum of 16 in a message queue in batches by inputting the corresponding ReceiptHandle for each.

This interface is recommended to used along with BatchReceiveMessage for higher efficiency.

The batch operation result may contain both successful and failed sub-requests.The HTTP status code is 204 only when all sub-requests are successful.If some sub-requests failed, you need to check the error information of every sub-request in the response.

**Request**
A request mainly includes the following parts:

- Request line

  DELETE /queues/$queueName/messages HTTP/1.1

- Special URI Parameter

  None.

- Special Request Header

  None. See "Public Request Headers".

- Request Body

  Request Body is in XML format. XML contains the ReceiptHandles of multiple messages.

**Response**
The returned message includes 3 parts: returned status line, HTTP header and message body.

- HTTP Status Code

  HTTP/1.1 204 NoContent

- Special Response Header

  None. See "Public Returned Headers".

- Response Body

  None.
  
**Special Error**

|Error Code|Error Message|Status Code|
|---|---|---|
|QueueNotExist|The queue name you provided is not exist.|404|
|InvalidArgument|The value of Element should between Low and High seconds/bytes.|400|
|ReceiptHandleError|The receipt handle you provide is not valid.|400|

**Request example:**
```
    DELETE  /queues/$queueName/messages HTTP/1.1
    Host: $AccountId.mns.cn-hangzhou.aliyuncs.com
    Date: Wed, 28 May 2012 22:32:00 GMT
    x-mns-version: 2015-06-06
    Authorization: MNS 15B4D3461F177624206A:xQE0diMbLRepdf3YB+FIEXAMPLE

	<?xml version="1.0” encoding=”UTF-8” ?>
    <ReceiptHandles xmlns=”http://mns.aliyuncs.com/doc/v1/”>
		<ReceiptHandle>1-ODU4OTkzNDU5My0xNDM1MTk3NjAwLTItNg==</ReceiptHandle>
		<ReceiptHandle>1-ODU4OTkzNDU5NC0xNDM1MTk3NjAwLTItNg==</ReceiptHandle>
		<ReceiptHandle>1-ODU4OTkzNDU5NS0xNDM1MTk3NjAwLTItNg==</ReceiptHandle>
	</ReceiptHandles>
```

**Response example:**

- Delete all messages successful.
   ```
    HTTP/1.1 204 NoContent
    x-mns-request-id:512B2A634403E52B1956133E
    x-mns-version: 2015-06-06
   ```

- Some messages failed to delete.
   ```
    HTTP/1.1 404
    Connection:close
    Content-Type=text/xml;charset=utf-8
    Content-Length:500
    x-mns-request-id:512B2A634403E52B1956133E
    x-mns-version: 2015-06-06

    <?xml version="1.0” encoding=”UTF-8” ?>
    <Errors xmlns=”http://mns.aliyuncs.com/doc/v1/”>
	<Error>
		<ErrorCode>MessageNotExist</ErrorCode>
		<ErrorMessage>Message not exist.</ErrorMessage>
		<ReceiptHandle>1-ODU4OTkzNDU5My0xNDM1MTk3NjAwLTItNg==</ReceiptHandle>
	</Error>
	<Error>
		<ErrorCode>MessageNotExist</ErrorCode>
		<ErrorMessage>Message not exist.</ErrorMessage>
		<ReceiptHandle>1-ODU4OTkzNDU5NC0xNDM1MTk3NjAwLTItNg==</ReceiptHandle>
	</Error>
    </Errors>
   ```


#	PeekMessage
##	説明
このインターフェイスは、コンシューマーがメッセージを表示するために使用します。ReceiveMessage とは異なり、PeekMessage ではメッセージのステータスは変更されません。PeekMessage によってメッセージを取得した場合、メッセージは [Active] ステータスのままであり、表示や取得が可能です。しかし、メッセージを ReceiveMessage によって取得した場合、メッセージは [Inactive] ステータスに変わり、VisibilityTimeout 期間の間は表示も取得もできません。
##	リクエスト
リクエストには、主に次の項目があります。

- リクエスト行
> `GET /$queueName/messages?peekonly=true HTTP/1.1`

- URI パラメーター
> peekonly=true の場合、このリクエストを使用するとキュー内の最初のメッセージが表示されるだけで、メッセージのステータスは変更されません。

- 特別なリクエストヘッダー
> なし。「パブリックリクエストヘッダー」を参照してください。

- リクエスト本文
> なし。

##	応答
返されるメッセージには、戻りステータス行、HTTP ヘッダー、メッセージ本文の 3 つがあります。

- HTTP ステータスコード
> HTTP/1.1 200 OK

- 特別な応答ヘッダー
> なし。「パブリックリターンヘッダー」を参照してください。

- 応答本文
> 結果は XML 形式で返されます。メッセージのメッセージ本文と属性が返されます。

|パラメーター名| 説明|
|---|---|
|MessageId|	メッセージ ID、各キューの中で一意|
|MessageBody|	メッセージ本文|
|MessageBodyMD5|	メッセージ本文の MD5 値|
|EnqueueTime|	メッセージがキューに送信された日時を 1970 年 1 月 1 日 0:00 からのミリ秒単位の経過時間で表した値|
|FirstDequeueTime|	メッセージが最初に取得された日時を 1970 年 1 月 1 日 0:00 からのミリ秒単位の経過時間で表した値。DequeueCount が 0 の場合、メッセージの EnqueueTime と同じ|
|DequeueCount|	メッセージが取得された合計回数|
|Priority	|メッセージの優先順位|

##	特殊なエラー
|エラーコード|	エラーメッセージ|	ステータスコード|
|---|---|---|
|QueueNotExist|指定された名前のキューは存在しません。|404|
|MessageNotExist|メッセージが存在しません。	|404|

**リクエストの例:**

```
    GET  /queues/$queueName/messages?peekonly=true HTTP/1.1
    Host: $AccountId.mns.cn-hangzhou.aliyuncs.com
    Date: Wed, 28 May 2012 22:32:00 GMT
    x-mns-version: 2015-06-06
    Authorization: MNS 15B4D3461F177624206A:xQE0diMbLRepdf3YB+FIEXAMPLE
```

**戻り値の例:**

```xml
    HTTP/1.1 200 OK
    Connection:close
    Content-Type=text/xml;charset=utf-8
    Content-Length:500
    x-mqs-request-id:512B2A634403E52B1956133E
    x-mqs-version: 2015-06-06

    <?xml version="1.0" encoding="UTF-8"?>
    <Message xmlns="http://mqs.aliyuncs.com/doc/v1/">
		<MessageId>D6D5F7C9C12D14A4-1-14D953EFC72-200000004</MessageId>
		<MessageBodyMD5>F9360F391579E71CA77BC5D50242FCF4</MessageBodyMD5>
		<MessageBody>This is a test message</MessageBody>
		<EnqueueTime>1250700979248</EnqueueTime>
		<FirstDequeueTime>1250700979348</FirstDequeueTime >
		<DequeueCount>5</DequeueCount>
		<Priority>8<Priority>
    </Message>
```
# BatchPeekMessage
## Description
This interface is used by the consumer to view messages in batches at a maximum of 16 at a time.Different from BatchReceiveMessage, BatchPeekMessage does not change the message status. If messages are acquired by BatchPeekMessage, the messages are still in Active status and can be viewed or consumed. However, if the messages are acquired by BatchReceiveMessage, the messages change to Inactive status and cannot be viewed or consumed within the VisibilityTimeout period.

**Request**
A request mainly includes the following parts:
- Request line

   `GET /queues/$queueName/messages?peekonly=true&numOfMessages=16 HTTP/1.1`

- Special URI Parameter

|Parameter Name|Description|Required?|
|---|---|---|
|peekonly=true|Indicates that this request is used only to view the first message in the queue and will not change the message status|Required|
|numOfMessages|Maximum number of messages that can be viewed for the current BatchPeekMessage operation|Required|

- Special Request Header

   None. See "Public Request Headers".

- Request Body

   None.

**Response**

The returned message includes 3 parts: returned status line, HTTP header and message body.

- HTTP Status Code

   HTTP/1.1 200 OK

- Special Response Header

   None. See "Public Returned Headers".

- Response Body

   The return result is in XML format. The message bodies and attributes of multiple messages are returned.

|Parameter Name|Description|
|---|---|
|MessageId|Message ID, which is unique in one queue|
|MessageBody|Message body|
|MessageBodyMD5|MD5 value of the message body|
|EnqueueTime|Time when a message is sent to the queue, represented in milliseconds that have elapsed since 1970-1-1 0:00|
|FirstDequeueTime|Time when a message is consumed for the first time, represented in milliseconds that have elapsed since 1970-1-1 0:00. If DequeueCount is 0, it is the same as EnqueueTime of the message|
|DequeueCount|Total consumption times of a message|
|Priority|Priority of a message|

**Special Error**

|Error Code|Error Message|Status Code|
|---|---|---|
|QueueNotExist|The queue name you provided is not exist.|404|
|MessageNotExist|Message not exist.|404|

**Request example:**

```
    GET  /queues/$queueName/messages?peekonly=true&numOfMessages=16 HTTP/1.1
    Host: $AccountId.mns.cn-hangzhou.aliyuncs.com
    Date: Wed, 28 May 2012 22:32:00 GMT
    x-mns-version: 2015-06-06
    Authorization: MNS 15B4D3461F177624206A:xQE0diMbLRepdf3YB+FIEXAMPLE
```

**Response example:**

```
    HTTP/1.1 200 OK
    Connection:close
    Content-Type=text/xml;charset=utf-8
    Content-Length:500
    x-mns-request-id:512B2A634403E52B1956133E
    x-mns-version: 2015-06-06

    <?xml version="1.0" encoding="UTF-8"?>
    <Messages xmlns=”http://mns.aliyuncs.com/doc/v1/”>
	<Message>
		<MessageId>D6D5F7C9C12D14A4-1-14D953EFC72-200000004</MessageId>
		<MessageBodyMD5>F9360F391579E71CA77BC5D50242FCF4</MessageBodyMD5>
		<MessageBody>This is a test message</MessageBody>
		<EnqueueTime>1250700979248</EnqueueTime>
		<FirstDequeueTime>1250700979348</FirstDequeueTime >
		<DequeueCount>5</DequeueCount>
		<Priority>8<Priority>
	</Message>
	<Message>
		<MessageId>D6D5F7C9C12D14A4-1-14D953EFC72-200000005</MessageId>
		<MessageBodyMD5>F9360F391579E71CA77BC5D50242FCF4</MessageBodyMD5>
		<MessageBody>This is a test message</MessageBody>
		<EnqueueTime>1250700979250</EnqueueTime>
		<FirstDequeueTime>1250700979352</FirstDequeueTime >
		<DequeueCount>5</DequeueCount>
		<Priority>8<Priority>
	</Message>
    </Messages>
```

# ChangeMessageVisibility
##	説明
このインターフェイスは、取得されたメッセージがまだ [Inactive] ステータスの間に、次に取得できる日時を変更するために使用します。VisibilityTimeout を変更すると、新しい ReceiptHandle が返されます。
## リクエスト
リクエストには、主に次の項目があります。

- リクエスト行
> ` PUT /$queueName/messages?receiptHandle=<receiptHandle>&visibilityTimeout=<visibilitytimeout> HTTP/1.1`

- URI パラメーター

|パラメーター名|	説明|	必須かどうか|
|---|---|---|
|ReceiptHandle|	前回の取得の後で返された ReceiptHandle。詳細については、「ReceiveMessage インターフェイス」を参照してください。|必須|
|VisibilityTimeout|現在の日時と取得可能な日時の間の時間 (秒)|必須|


- 特別なリクエストヘッダー
> なし。「パブリックリクエストヘッダー」を参照してください。

- リクエスト本文
> なし。

##	応答
返されるメッセージには、戻りステータス行、HTTP ヘッダー、メッセージ本文の 3 つがあります。

- HTTP ステータスコード
> HTTP/1.1 200 OK

- 特別な応答ヘッダー
> なし。「パブリックリターンヘッダー」を参照してください。

- 応答本文

|パラメーター名| 説明|
|---|---|
|ReceiptHandle|メッセージの VisibilityTimeout が変更された後で返された一時的なハンドル。まだ [Inactive] ステータスで、NextVisibleTime になる前のメッセージを削除または変更するために使用します。|
|NextVisibleTime|メッセージを再度取得できる日時を 1970 年 1 月 1 日 0:00 からのミリ秒単位の経過時間で表した値。|

##	特殊なエラー
|エラーコード|エラーメッセージ|ステータスコード|
|---|---|---|
|QueueNotExist|指定された名前のキューは存在しません。|404|
|InvalidArgument|Element の値は、Low と High の間の秒数またはバイト数にする必要があります。|	400|
|MessageNotExist|メッセージが存在しません。	|404|

**リクエストの例:**

```
    PUT /queueName/messages
    ?receiptHandle=MbZj6wDWli+QEauMZc8ZRv37sIW2iJKq3M9Mx/KSbkJ0&visibilityTimeout=50 HTTP/1.1
    Host: $AccountId.mqs-cn-hangzhou.aliyuncs.com
    Date: Wed, 28 May 2012 22:32:00 GMT
    x-mqs-version: 2014-07-08
    Authorization: MQS 15B4D3461F177624206A:xQE0diMbLRepdf3YB+FIEXAMPLE
```

**戻り値の例:**

```xml
    HTTP/1.1 200OK
    x-mqs-request-id:512B2A634403E52B1956133E
    x-mqs-version: 2015-06-06

    <?xml version="1.0" encoding="UTF-8" ?>
    <Message xmlns="http://mqs.aliyuncs.com/doc/v1/">
        <ReceiptHandle>TbZj6wDWli+9CEauMZc8ZRv37sIW2iJKq3M9Mx/TS1</ReceiptHandle >
        <NextVisibleTime>1250700979298000</NextVisibleTime>
    </Message>
```
